<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Title of the document</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.maphilight.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
<script src="http://qtip2.com/v/stable/jquery.qtip.js"> </script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <style>
        #map {
            height: 550px;
            width: 600px;
        }

        html,
        body {
            margin: 0;
            padding: 0;
        }
    </style>
<script type="text/javascript">
$(document).ready(function() {


    function colorChange(rulVal,index){
	//console.log(rulVal);
	//console.log(index);
	var circleId;
		if(index==0)circleId='a';
		if(index==1)circleId='o';
		if(index==2)circleId='n';
	
	if(rulVal>60){
	
		colorGreen(circleId);

	}
	else{
		colorRed(circleId);
	}
        /*$("#"+id).data('maphilight', {"stroke":0, "alwaysOn": true, "fillColor":fillcolor, "fillOpacity":1});
	setInterval(function() {
	      if(data.fillColor == 'ff0000')
                fillcolor = '62ce54';
	      else
                fillcolor = 'ff0000';
              $("#"+id).data('maphilight', {"stroke":0, "alwaysOn": true, "fillColor":fillcolor, "fillOpacity":1});
	      colorChange(data,id);
	},60);*/
    }
    function colorRed(id){

	$("#"+id).data('maphilight', {"stroke":0, "alwaysOn": true, "fillColor":"ff0000", "fillOpacity":1});

    }
    function colorGreen(id){
	console.log(id);
        $("#"+id).data('maphilight', {"stroke":0, "alwaysOn": true, "fillColor":"62ce54", "fillOpacity":1});

    }
    $('.map').maphilight();
    $('area').each(function () {
        var elem = $(this),
            map = elem.parent(),
            image = $('img[usemap="#'+map.attr('name')+'"]');
    	var data = $(this).data('maphilight') || {};
	var fillcolor = data.fillColor;
	if(fillcolor == 'ff0000'){

        var circleid = $(this).attr('id');
	    var interval = 60; // where X is your every X minutes
            setInterval(function() {
		colorChange(data,circleid);	
	    }, 1000);
	}
	
        elem.qtip({
            content: {
                text: elem.attr('alt'), // Attempt to grab content from #statesMap-<State> elements first
                attr: 'alt' // No content? Grab the content from the 'alt' attribute
            },
            position: {
                viewport: image
            },
            show: {
                event: 'mouseover',
                solo: true
            },
            hide: {
                // Allow the user to hover on the tooltip
                fixed: true,
                delay: 200
            },
            style: {
                classes: 'qtip-tipsy'
	     }
        });
    });


    var guageReading = [];

    $('.circle').click(function(e) { 
        e.preventDefault();
	$("#chartType").css("display","block");
	$("input:radio:first").prop("checked", true).trigger("click");
        var titles = [];
        var unit = 'Unit_1';
	var max = 270;
	var device = getUrlParameter('dev');
	window.open("ChartIndexWithTimegraph.html?dev="+device+"&id="+e.target.id);
});

      var getUrlParameter = function getUrlParameter(sParam) {
	var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
    	for (i = 0; i < sURLVariables.length; i++) {
        	sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] === sParam) {
        	    return sParameterName[1] === undefined ? true : sParameterName[1];
        	}
    	}
      };

         var deviceName = getUrlParameter('dev');
	 var latitude = getUrlParameter('latitude');
	 var longtitude = getUrlParameter('longtitude');
	$("#img_desc").html(deviceName);        
	var data =  getDevicesAndRulList(deviceName,latitude,longtitude);
	//console.log( data );
		var chartData = [];
var devicesNames = [];
var rulValues=[];
        for (var i in data) {
            var item = data[i];
	//console.log( item );


            if (typeof item === "object") {
                for (var j in item) {
                    var temp = [];
                    var myitem = item[j];

                    if (typeof myitem === "object") {
                        for(var k in myitem){

			if(k==="name")devicesNames.push(myitem[k]);
			else if(k==="rulVal")rulValues.push(myitem[k]);
                           temp.push(myitem[k]);

			}
                    }

                }
           }
           
        }
	console.log( devicesNames);
	console.log( rulValues);
	for(var l=0;l<  rulValues.length;l++){
		colorChange(rulValues[l],l);
	}
	function getDevicesAndRulList(device,latitude,longtitude){  
		var duration = 12*60;  // in mins
		var url = 'http://localhost:8080/getDeviceLifecyclePredictions?oilRigId='+device+'&latitude='+latitude+'&longtitude='+longtitude+'&durationInMins='+ duration;

        	var devicesData =  $.ajax({
                	type: "GET",
	                url:'http://localhost:8080/getDeviceLifecyclePredictions?oilRigId='+device+'&latitude='+latitude+'&longtitude='+longtitude+'&durationInMins='+ duration,
        	        async: false
	        }).responseText;

        	var myObject = eval('(' + devicesData + ')');
	        return myObject;
     	}

});
</script>
</head>

<!--
<body style="background:black;color:white;">
-->
<body>
<div class="main-container" style="max-height:1000px;">
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="/">  Life Cycle Predictions </a>
        </div>
        
    </div>
</div>

     <div style="width:30%;position:absolute;top:160px;left:270px;z-index:1000" id="pie-chart">
            <div style="" id="piechart"> </div>
     </div>
     <div style="display:flex;" style="width:100%;">
        <div style="margin-right:2%;">
		<img src="images/oilrig1.jpg" width="550" height="650" class="map" usemap="#sensormap"/>
		<h1 style="text-align:center;" id="img_desc"> </h1>
		<h4 style="text-align:center;color:darkgreen;font-weight:bold"> A ---> Crown Block </h4>
                <h4 style="text-align:center;color:darkgreen;font-weight:bold"> O --->  Traveling Block </h4>
                <h4 style="text-align:center;color:darkgreen;font-weight:bold"> N ---> Top Drive  </h4>
		
	</div>
        
     </div>
</div>


<map name="sensormap">
    <area alt="Crown Block" shape="circle" coords="259,24,9.8" href="" class="circle" id="a" data-maphilight='{"alwaysOn": true,"stroke":false,"fillColor":"62ce54","fillOpacity":1}'/>
    <area alt="Traveling Block" shape="circle" coords="256,283,9.8" href="" class="circle" id="o" data-maphilight='{"alwaysOn": true,"stroke":false,"fillColor":"62ce54","fillOpacity":1}'/>

    <area alt="Top Drive" shape="circle" coords="255,311,9.8" href="" class="circle" id="n" data-maphilight='{"alwaysOn": true,"stroke":false,"fillColor":"62ce54","fillOpacity":1}'/>


</map>

<script>

google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(function(){});




</script>
</body>
</html>
