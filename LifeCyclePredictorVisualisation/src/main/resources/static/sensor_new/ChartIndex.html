<!DOCTYPE html>
<html>

<head>
    <title> OilRigs Life Cycle Prediction </title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/Chart.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

     <style>
	.panel {
	    margin-bottom: 20px;
	    background-color: #fff;
	    border: 1px solid transparent;
	    border-radius: 4px;
	    -webkit-box-shadow: 0 1px 1px rgba(0,0,0,.05);
	    box-shadow: 0 1px 1px rgba(0,0,0,.05);
	}
	.panel-default {
	    border-color: #ddd;
	}
	.panel-default>.panel-heading {
	    color: #333;
	    background-color: #f5f5f5;
	    border-color: #ddd;
	}
	.panel-heading {
	    padding: 10px 15px;
	    border-bottom: 1px solid transparent;
	    border-top-left-radius: 3px;
	    border-top-right-radius: 3px;
	}
	.panel-body {
	    padding: 15px;
	}
	.donutChart {
 	   min-height: 300px;
	}
     </style>
</head>
<body style="background:#F2F2F2;">
    <div class="main-container" style="padding:15px;height:600px;">
        <div style="display:flex;height:350px;margin-bottom:1%;" class="row">
            <div style="width:25%;" id="donutOne" class="donutChart">
		<canvas id="donut1"></canvas>
            </div>
            <div style="width:25%;" id="donutTwo" class="donutChart">
		<canvas id="donut2"></canvas>
            </div>
            <div class="donutChart" style="width:25%;" id="donutThree">
		<canvas id="donut3"></canvas>
            </div>
            <div style="width:25%;" class="donutChart" id="donutFour">
		<canvas id="donut4"></canvas>
            </div>

	</div>
	<div class="row">
            <div class="col-md-12" style="display:flex;">
		<div class="panel panel-default" style="width:50%;margin-right:1%;">
                        <div class="panel-body">
		                <div class="sensor" id="sensor1">
	
				</div>
			</div>
		</div>
		<div class="panel panel-default" style="width:50%;">
                        <div class="panel-body">
		                <div class="sensor" id="sensor2">
                		
				</div>
			</div>
		</div>    
           </div>
	   <div class="col-md-12" style="display:flex;" >
		<div class="panel panel-default" style="width:50%;margin-right:1%;">
                        <div class="panel-body">
		                <div class="sensor" id="sensor3">

				</div>    
                        </div>   
                </div>
		<div class="panel panel-default" style="width:50%;">
                        <div class="panel-body">
		                <div class="sensor" id="sensor4">
                	
				</div>    
                        </div>       
                </div>
           </div>
	</div>
  </div>


  <script>
     
  $(document).ready(function(){
      var device = getUrlParameter('dev');
      var id = getUrlParameter('id');
      function showCharts(device,id){
	var guageReading = [];
 	var titles = [];
        var unit = 'Unit_1';
        if(id == 'a'){
                $("#head").html("Crown Block");
                titles = ['Model41',"FP2000",'MLH','SPT'];
                unit = 'Unit_0';
        }
        else if(id == 'o'){
                titles = ['Model41',"IPIS",'MLH','811FM'];
                $("#head").html("Traveling Block");
                unit = 'Unit_1';
        }
        else if(id == 'n'){
                titles = ['FP2000',"811FM",'Model41','MLH']
                $("#head").html("Top Drive");
                unit = 'Unit_0';
        }
        var data = getSensorReadings(device,unit);
	 var chartData = [];
		var sensor_titles = [];
        for (var i in data) {
            var item = data[i];
	//console.log( item );
            var outer = [];

            if (typeof item === "object") {
                for (var j in item) {
			sensor_titles.push(j);
                    var temp = [];
                    var myitem = item[j];
			//console.log( myitem);
                    if (typeof myitem === "object") {
                        for(var k in myitem)
                           temp.push(myitem[k]);
                    }
                    outer.push(item[j]);
                }
           }
           if (outer.length) {
                chartData.push(outer);
           }
        }

        var cData = chartData[0];
	console.log(chartData[0]);
        var sensorChartdata = [];
        for(var ind = 0; ind < cData.length; ind++){
                var temp = $.map(cData[ind], function(value, index) {
                    return [value];
                });
                sensorChartdata.push(temp);
        }
        for(var i=0;i<4;i++){
//console.log( sensor_titles[i] );
	        var title = sensor_titles[i];
        	var id = 'sensor'+(parseInt(i)+1);
	        var sensorReadings = [];
        	for(var jj =0; jj < sensorChartdata.length; jj++){
                	var datas1 = [];
	                var Header= ['Range', 'LifeCycleValue'];
        	        datas1.push(Header);
                	for (var ii = 0; ii < sensorChartdata[jj].length; ii++) {
	                      var temp=[];
        	              var values1 = [ii+1,sensorChartdata[jj][ii]];                     
                	      datas1.push(values1);
                	}
	                sensorReadings.push(datas1);
	                guageReading[jj] = datas1[datas1.length - 1];
       		}
       		if(i == 0){
                       $("#sensor1").css("cssText","background:url('images/"+titles[i]+".png');background-repeat:no-repeat;backgroud-size:120px 150px;background-position:center;");
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){
                  	      	var chartdata1 = google.visualization.arrayToDataTable(sensorReadings[0]);  
				//console.log(sensorReadings[0]);     
				drawChart1(sensor_titles[0],chartdata1,"sensor1")
			});

			google.charts.load('current', {'packages':['corechart']});
			google.charts.setOnLoadCallback(function(){drawDonutChartUsingChartJS(sensor_titles[0],"donut1",guageReading[0][1])});
                }
                else if(i == 1){
                      $("#sensor2").css("cssText","background:url('images/"+titles[i]+".png');background-repeat:no-repeat;backgroud-size:300px 200px;background-position:center;");
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){
	                      	var chartdata2 = google.visualization.arrayToDataTable(sensorReadings[1]);        
				drawChart1(sensor_titles[1],chartdata2,"sensor2")
			});
			google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){drawDonutChartUsingChartJS(sensor_titles[1],"donut2",guageReading[1][1])});
                }
                else if(i == 2){
                       $("#sensor3").css("cssText","background:url('images/"+titles[i]+".png');background-repeat:no-repeat;backgroud-size:300px 200px;background-position:center;");
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){
                       		var chartdata3 = google.visualization.arrayToDataTable(sensorReadings[2]);       
				drawChart1(sensor_titles[2],chartdata3,"sensor3")
			});
			google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){drawDonutChartUsingChartJS(sensor_titles[2],"donut3",guageReading[2][1])});
                }
                else if(i == 3){
                       $("#sensor4").css("cssText","background:url('images/"+titles[i]+".png');background-repeat:no-repeat;backgroud-size:300px 200px;background-position:center;");
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){
                       		var chartdata4 = google.visualization.arrayToDataTable(sensorReadings[3]);       
				drawChart1(sensor_titles[3],chartdata4,"sensor4")
			});
			google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(function(){drawDonutChartUsingChartJS(sensor_titles[3],"donut4",guageReading[3][1])});
                }
         }
     }

    function drawChart1(title,data,id) {
//console.log( data );
          var options = {
	       backgroundColor: 'none',
	       title: title,
	       curveType: 'function',
	       legend: { position: 'bottom' },
	       /*hAxis: {
			textStyle:{color: '#FFF'},
	        	maxValue: max
	       },
	       vAxis: {
       			textStyle:{color: '#FFF'}
               }*/
         };
         var chart = new google.visualization.LineChart(document.getElementById(id));
         chart.draw(data, options);
    }
  
     function drawDonutChartUsingChart(title,id,donutvalue) {
        var percentage = Math.ceil(donutvalue / 50)+1;
        var donutpercentage = Math.ceil(donutvalue/percentage);
        var remining = 50 - donutpercentage;
        var data = google.visualization.arrayToDataTable([
                   ['Task', 'Hours per Day'],
        	   ['', 50],
		   ['', donutpercentage],
		   ['', remining]
        ]);
      
        var options = {
                 title: "",
	        legend:"none",
        	slices: {
	            0: {
        	        color: 'transparent',
                	enableInteractivity: false
            	   },
	           2: {
        	        color:"#d3d3d3",
                	enableInteractivity: false
	            },
        	  pieSliceText: 'none',
	        },
        	pieHole: 0.5,
	        pieStartAngle: 90
        };

        var chart = new google.visualization.PieChart(document.getElementById(id));
        chart.draw(data, options);
    }

function drawDonutChartUsingChartJS(title,id,donutvalue){
	var Max_value = 1900; 
var data1 = {
        labels: ["Current Reading"],
        datasets: [
            {
                data: [donutvalue, Max_value - donutvalue ],
                backgroundColor: [
                    "#ef5350",
                    "#D3D3D3"
                ],
                /*borderColor: [
                    "#CDA776",
                    "#989898",
                ],*/
		hoverBackgroundColor: [
                        "#b61827",
                        "#D3D3D3"
                ],
                borderWidth: [1, 1]
            }
        ]
    };

	var options = {
        responsive: true,
	animation: {
                animateRotate: true,
                animateScale: true,
                animateRotate : true,
        }, 
	rotation: 3/4 * Math.PI,
        circumference: (3/2) * Math.PI, 
        title: {
            display: true,
            position: "top",
            text: title,
            fontSize: 18,
            fontColor: "#111"
        },
        legend: {
            display: true,
            position: "bottom",
            labels: {
                fontColor: "#333",
                fontSize: 16
            }
        }
    };
	
	//create Chart class object
    var chart1 = new Chart(id, {
        type: "doughnut",
        data: data1,
        options: options
    });

}
 
    function getUrlParameter(sParam) {
        var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
        for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] === sParam) {
                    return sParameterName[1] === undefined ? true : sParameterName[1];
                }
        }
   };
  
   function getSensorReadings(device,unit){    
                var sensordata =  $.ajax({
                        type: "GET",
                        url:'http://192.168.2.22:8080/getSensorReadingsForDevice?deviceId='+unit+'&industrialPlantId='+device,
                        async: false
                }).responseText;
                var myObject = eval('(' + sensordata + ')');
                return myObject;
   }



      showCharts(device,id);

  });
    </script>
</body>
</html>
